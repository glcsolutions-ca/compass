{
  "version": "1",
  "scopeRules": {
    "runtime": [
      "apps/api/**",
      "apps/web/**",
      "apps/codex-app-server/**",
      "apps/codex-session-runtime/**",
      "apps/worker/**",
      "packages/**",
      "db/migrations/**",
      "db/scripts/**",
      "apps/api/Dockerfile",
      "apps/web/Dockerfile",
      "apps/codex-app-server/Dockerfile",
      "apps/codex-session-runtime/Dockerfile",
      "package.json",
      "pnpm-lock.yaml",
      "pnpm-workspace.yaml",
      "**/package.json"
    ],
    "desktop": ["apps/desktop/**", ".github/workflows/desktop-deployment-pipeline.yml"],
    "infra": ["infra/azure/**"],
    "identity": ["infra/identity/**"],
    "migration": ["db/migrations/**", "db/scripts/**"],
    "infraRollout": [
      "infra/azure/main.bicep",
      "infra/azure/modules/containerapp-*.bicep",
      "infra/azure/modules/containerapps-env.bicep",
      "infra/azure/environments/*.bicepparam",
      "infra/azure/environments/**"
    ],
    "docsOnly": [
      "docs/**",
      "README.md",
      "CONTRIBUTING.md",
      "AGENTS.md",
      ".github/workflows/**",
      ".github/policy/**",
      "scripts/pipeline/**",
      "apps/**/README.md",
      "packages/**/README.md",
      "scripts/**/README.md",
      "tests/**/README.md",
      "infra/**/README.md"
    ]
  },
  "commitStage": {
    "requiredChecks": [
      "determine-scope",
      "commit-test-suite",
      "desktop-commit-test-suite",
      "commit-stage"
    ],
    "slo": {
      "targetSeconds": 300,
      "mode": "enforce"
    }
  },
  "highRiskMainlinePolicy": {
    "ruleId": "HR001",
    "mainBranch": "main",
    "requirePullRequestOnMain": true,
    "codeOwners": ["@jrkropp"],
    "categories": [
      {
        "id": "infra-mutation",
        "patterns": ["infra/azure/**", "infra/identity/**"],
        "rationale": "production infrastructure and identity control-plane mutation risk"
      },
      {
        "id": "data-mutation",
        "patterns": ["db/migrations/**", "db/scripts/**"],
        "rationale": "schema/data integrity and rollout/rollback risk"
      },
      {
        "id": "pipeline-governance-mutation",
        "patterns": [".github/workflows/**", ".github/policy/**", "scripts/pipeline/**"],
        "rationale": "deployment pipeline config and release/deploy decision behavior risk"
      }
    ]
  },
  "deploymentStage": {
    "requireFreshHeadOnAuto": true
  },
  "cloudDeploymentPipeline": {
    "requiredChecks": [
      "verify-commit-stage-evidence",
      "verify-integration-gate-evidence",
      "build-release-candidate-api-image",
      "build-release-candidate-web-image",
      "build-release-candidate-worker-image",
      "build-release-candidate-codex-image",
      "publish-release-candidate",
      "deploy-cloud",
      "production-smoke",
      "release-decision"
    ],
    "slo": {
      "mode": "observe",
      "deployCloudTargetSeconds": 1200,
      "productionSmokeTargetSeconds": 600
    }
  },
  "desktopDeploymentPipeline": {
    "requiredChecks": [
      "desktop-commit-stage",
      "desktop-automated-acceptance-test-gate",
      "desktop-deployment-stage",
      "desktop-release-decision"
    ],
    "artifactContracts": {
      "releaseCandidateManifestPath": ".artifacts/desktop-release-candidate/<sha>/manifest.json",
      "automatedAcceptanceTestGateResultPath": ".artifacts/desktop-automated-acceptance-test-gate/<sha>/result.json",
      "deploymentResultPath": ".artifacts/desktop-deployment-stage/<sha>/result.json",
      "releaseDecisionPath": ".artifacts/desktop-release/<sha>/decision.json"
    },
    "slo": {
      "mode": "observe",
      "automatedAcceptanceTestGateTargetSeconds": 1800,
      "deploymentStageTargetSeconds": 1200
    }
  },
  "docsDriftRules": {
    "blockingPaths": [
      ".github/workflows/*.yml",
      ".github/workflows/*.yaml",
      ".github/policy/**",
      "scripts/pipeline/**",
      "infra/azure/**",
      "infra/identity/**",
      "deploy/**"
    ],
    "docsCriticalPaths": [
      "contracts/**",
      "schemas/**",
      "openapi/**",
      "proto/**",
      "db/migrations/**",
      "db/scripts/**",
      "config/**",
      "infra/**",
      "infra/azure/**",
      "infra/identity/**",
      "packages/contracts/**",
      "packages/contracts/openapi/**"
    ],
    "docTargets": [
      "docs/commit-stage-policy.md",
      "docs/branch-protection.md",
      ".github/policy/README.md",
      ".github/workflows/README.md",
      "docs/contracts/**",
      "docs/runbooks/**"
    ]
  },
  "integrationGate": {
    "requiredChecks": [
      "determine-scope",
      "build-compile",
      "migration-safety",
      "runtime-contract-smoke",
      "minimal-integration-smoke",
      "integration-gate"
    ],
    "telemetry": {
      "sampleSize": 20
    }
  }
}
