# Codex Session Runtime

## Purpose

`apps/codex-session-runtime` is the runtime host for Codex turns. It is used in two ways:

1. Local development runtime provider (`AGENT_RUNTIME_PROVIDER=local_process` or `local_docker`)
2. Dynamic Sessions container image in cloud deployments (`dynamic_sessions`)

## Local Lifecycle Commands

Use explicit lifecycle commands (same model as local Postgres):

- `pnpm runtime:session:up`
- `pnpm runtime:session:down`
- `pnpm runtime:session:reset`
- `pnpm runtime:session:status`
- `pnpm runtime:session:logs`

Optional Docker parity lane:

- `pnpm runtime:session:up:docker`
- `pnpm runtime:session:down:docker`
- `pnpm runtime:session:reset:docker`

`pnpm dev` does not start this runtime automatically.

## Environment

Generated by `scripts/dev/ensure-local-env.mjs`:

- `apps/codex-session-runtime/.env`
- `apps/api/.env` (`AGENT_RUNTIME_PROVIDER` + `AGENT_RUNTIME_ENDPOINT`)

Key runtime vars:

- `SESSION_RUNTIME_ENGINE=codex|mock`
- `CODEX_APP_SERVER_COMMAND` (default `codex`)
- `CODEX_APP_SERVER_ARGS` (default `app-server`)
- `OPENAI_API_KEY` (optional for API key auto-login in codex engine)

## Runtime Auth

When provider is local (`local_process` or `local_docker`), the API exposes:

- `POST /v1/agent/runtime/account/read`
- `POST /v1/agent/runtime/account/login/start`
- `POST /v1/agent/runtime/account/login/cancel`
- `POST /v1/agent/runtime/account/logout`
- `POST /v1/agent/runtime/account/rate-limits/read`
- `GET /v1/agent/runtime/stream` (websocket upgrade endpoint)

Use Settings > General > Runtime account to connect ChatGPT or API key for local runtime.
