services:
  runtime:
    build:
      context: ../..
      dockerfile: apps/codex-session-runtime/Dockerfile
    environment:
      HOST: 0.0.0.0
      PORT: ${PORT:-8080}
      SESSION_RUNTIME_ENGINE: ${SESSION_RUNTIME_ENGINE:-codex}
      CODEX_APP_SERVER_COMMAND: ${CODEX_APP_SERVER_COMMAND:-codex}
      CODEX_APP_SERVER_ARGS: ${CODEX_APP_SERVER_ARGS:-app-server}
      CODEX_RUNTIME_REQUEST_TIMEOUT_MS: ${CODEX_RUNTIME_REQUEST_TIMEOUT_MS:-30000}
      CODEX_RUNTIME_TURN_TIMEOUT_MS: ${CODEX_RUNTIME_TURN_TIMEOUT_MS:-120000}
      CODEX_RUNTIME_INIT_TIMEOUT_MS: ${CODEX_RUNTIME_INIT_TIMEOUT_MS:-30000}
      CODEX_RUNTIME_MAX_RESTARTS: ${CODEX_RUNTIME_MAX_RESTARTS:-2}
      OPENAI_API_KEY: ${OPENAI_API_KEY:-}
    ports:
      - "${PORT:-8080}:${PORT:-8080}"
    restart: unless-stopped
