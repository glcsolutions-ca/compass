{
  "openapi": "3.1.0",
  "info": {
    "title": "Compass API",
    "version": "v1",
    "description": "Compass API baseline with Entra-first multi-tenant auth"
  },
  "servers": [
    {
      "url": "http://localhost:3001"
    }
  ],
  "tags": [
    {
      "name": "System",
      "description": "Platform system endpoints"
    },
    {
      "name": "Auth",
      "description": "Authentication and session endpoints"
    },
    {
      "name": "Tenants",
      "description": "Tenant membership and invite endpoints"
    },
    {
      "name": "Agent",
      "description": "Agent thread and turn orchestration endpoints"
    }
  ],
  "components": {
    "securitySchemes": {
      "sessionCookieAuth": {
        "type": "apiKey",
        "in": "cookie",
        "name": "__Host-compass_session",
        "description": "Opaque server-side session cookie"
      }
    },
    "schemas": {
      "HealthResponse": {
        "type": "object",
        "properties": {
          "status": {
            "type": "string",
            "enum": [
              "ok"
            ]
          },
          "timestamp": {
            "type": "string",
            "format": "date-time"
          }
        },
        "required": [
          "status",
          "timestamp"
        ]
      },
      "PingResponse": {
        "type": "object",
        "properties": {
          "ok": {
            "type": "boolean",
            "enum": [
              true
            ]
          },
          "service": {
            "type": "string",
            "enum": [
              "api"
            ]
          }
        },
        "required": [
          "ok",
          "service"
        ]
      },
      "ApiError": {
        "type": "object",
        "properties": {
          "code": {
            "type": "string",
            "minLength": 1
          },
          "message": {
            "type": "string",
            "minLength": 1
          }
        },
        "required": [
          "code",
          "message"
        ]
      },
      "AuthMeResponse": {
        "type": "object",
        "properties": {
          "authenticated": {
            "type": "boolean"
          },
          "user": {
            "type": [
              "object",
              "null"
            ],
            "properties": {
              "id": {
                "type": "string",
                "minLength": 1
              },
              "primaryEmail": {
                "type": [
                  "string",
                  "null"
                ],
                "format": "email"
              },
              "displayName": {
                "type": [
                  "string",
                  "null"
                ],
                "minLength": 1
              }
            },
            "required": [
              "id"
            ]
          },
          "memberships": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "tenantId": {
                  "type": "string",
                  "minLength": 1
                },
                "tenantSlug": {
                  "type": "string",
                  "minLength": 1
                },
                "tenantName": {
                  "type": "string",
                  "minLength": 1
                },
                "role": {
                  "type": "string",
                  "enum": [
                    "owner",
                    "admin",
                    "member",
                    "viewer"
                  ]
                },
                "status": {
                  "type": "string",
                  "enum": [
                    "active",
                    "invited",
                    "disabled"
                  ]
                }
              },
              "required": [
                "tenantId",
                "tenantSlug",
                "tenantName",
                "role",
                "status"
              ]
            }
          },
          "lastActiveTenantSlug": {
            "type": [
              "string",
              "null"
            ],
            "minLength": 1
          }
        },
        "required": [
          "authenticated",
          "memberships"
        ]
      },
      "TenantCreateRequest": {
        "type": "object",
        "properties": {
          "slug": {
            "type": "string",
            "minLength": 2,
            "maxLength": 64,
            "pattern": "^[a-z0-9]+(?:-[a-z0-9]+)*$"
          },
          "name": {
            "type": "string",
            "minLength": 1,
            "maxLength": 120
          }
        },
        "required": [
          "slug",
          "name"
        ]
      },
      "TenantCreateResponse": {
        "type": "object",
        "properties": {
          "tenant": {
            "type": "object",
            "properties": {
              "id": {
                "type": "string",
                "minLength": 1
              },
              "slug": {
                "type": "string",
                "minLength": 1
              },
              "name": {
                "type": "string",
                "minLength": 1
              },
              "status": {
                "type": "string",
                "enum": [
                  "active",
                  "disabled"
                ]
              }
            },
            "required": [
              "id",
              "slug",
              "name",
              "status"
            ]
          },
          "membership": {
            "type": "object",
            "properties": {
              "role": {
                "type": "string",
                "enum": [
                  "owner",
                  "admin",
                  "member",
                  "viewer"
                ]
              },
              "status": {
                "type": "string",
                "enum": [
                  "active",
                  "invited",
                  "disabled"
                ]
              }
            },
            "required": [
              "role",
              "status"
            ]
          }
        },
        "required": [
          "tenant",
          "membership"
        ]
      },
      "TenantReadResponse": {
        "type": "object",
        "properties": {
          "tenant": {
            "type": "object",
            "properties": {
              "id": {
                "type": "string",
                "minLength": 1
              },
              "slug": {
                "type": "string",
                "minLength": 1
              },
              "name": {
                "type": "string",
                "minLength": 1
              },
              "status": {
                "type": "string",
                "enum": [
                  "active",
                  "disabled"
                ]
              }
            },
            "required": [
              "id",
              "slug",
              "name",
              "status"
            ]
          }
        },
        "required": [
          "tenant"
        ]
      },
      "TenantMembersResponse": {
        "type": "object",
        "properties": {
          "members": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "userId": {
                  "type": "string",
                  "minLength": 1
                },
                "primaryEmail": {
                  "type": [
                    "string",
                    "null"
                  ],
                  "format": "email"
                },
                "displayName": {
                  "type": [
                    "string",
                    "null"
                  ],
                  "minLength": 1
                },
                "role": {
                  "type": "string",
                  "enum": [
                    "owner",
                    "admin",
                    "member",
                    "viewer"
                  ]
                },
                "status": {
                  "type": "string",
                  "enum": [
                    "active",
                    "invited",
                    "disabled"
                  ]
                }
              },
              "required": [
                "userId",
                "role",
                "status"
              ]
            }
          }
        },
        "required": [
          "members"
        ]
      },
      "TenantInviteCreateRequest": {
        "type": "object",
        "properties": {
          "email": {
            "type": "string",
            "format": "email"
          },
          "role": {
            "type": "string",
            "enum": [
              "admin",
              "member",
              "viewer"
            ]
          },
          "expiresInDays": {
            "type": "integer",
            "minimum": 1,
            "maximum": 30
          }
        },
        "required": [
          "email",
          "role"
        ]
      },
      "TenantInviteCreateResponse": {
        "type": "object",
        "properties": {
          "inviteId": {
            "type": "string",
            "minLength": 1
          },
          "expiresAt": {
            "type": "string",
            "format": "date-time"
          },
          "token": {
            "type": "string",
            "minLength": 1
          }
        },
        "required": [
          "inviteId",
          "expiresAt",
          "token"
        ]
      },
      "TenantInviteAcceptResponse": {
        "type": "object",
        "properties": {
          "joined": {
            "type": "boolean"
          },
          "tenantSlug": {
            "type": "string",
            "minLength": 1
          },
          "role": {
            "type": "string",
            "enum": [
              "owner",
              "admin",
              "member",
              "viewer"
            ]
          },
          "status": {
            "type": "string",
            "enum": [
              "active",
              "invited",
              "disabled"
            ]
          }
        },
        "required": [
          "joined",
          "tenantSlug",
          "role",
          "status"
        ]
      },
      "AgentThreadCreateRequest": {
        "type": "object",
        "properties": {
          "tenantSlug": {
            "type": "string",
            "minLength": 1
          },
          "executionMode": {
            "type": "string",
            "enum": [
              "cloud",
              "local"
            ],
            "default": "cloud"
          },
          "executionHost": {
            "type": "string",
            "enum": [
              "dynamic_sessions",
              "desktop_local"
            ]
          },
          "title": {
            "type": "string",
            "minLength": 1,
            "maxLength": 200
          }
        },
        "required": [
          "tenantSlug"
        ]
      },
      "AgentThreadCreateResponse": {
        "type": "object",
        "properties": {
          "thread": {
            "type": "object",
            "properties": {
              "threadId": {
                "type": "string",
                "minLength": 1
              },
              "tenantId": {
                "type": "string",
                "minLength": 1
              },
              "tenantSlug": {
                "type": "string",
                "minLength": 1
              },
              "executionMode": {
                "type": "string",
                "enum": [
                  "cloud",
                  "local"
                ]
              },
              "executionHost": {
                "type": "string",
                "enum": [
                  "dynamic_sessions",
                  "desktop_local"
                ]
              },
              "status": {
                "type": "string",
                "enum": [
                  "idle",
                  "inProgress",
                  "completed",
                  "interrupted",
                  "error"
                ]
              },
              "cloudSessionIdentifier": {
                "type": [
                  "string",
                  "null"
                ],
                "minLength": 1
              },
              "title": {
                "type": [
                  "string",
                  "null"
                ],
                "minLength": 1
              },
              "createdAt": {
                "type": "string",
                "format": "date-time"
              },
              "updatedAt": {
                "type": "string",
                "format": "date-time"
              },
              "modeSwitchedAt": {
                "type": [
                  "string",
                  "null"
                ],
                "format": "date-time"
              }
            },
            "required": [
              "threadId",
              "tenantId",
              "tenantSlug",
              "executionMode",
              "executionHost",
              "status",
              "createdAt",
              "updatedAt"
            ]
          }
        },
        "required": [
          "thread"
        ]
      },
      "AgentThreadReadResponse": {
        "type": "object",
        "properties": {
          "thread": {
            "type": "object",
            "properties": {
              "threadId": {
                "type": "string",
                "minLength": 1
              },
              "tenantId": {
                "type": "string",
                "minLength": 1
              },
              "tenantSlug": {
                "type": "string",
                "minLength": 1
              },
              "executionMode": {
                "type": "string",
                "enum": [
                  "cloud",
                  "local"
                ]
              },
              "executionHost": {
                "type": "string",
                "enum": [
                  "dynamic_sessions",
                  "desktop_local"
                ]
              },
              "status": {
                "type": "string",
                "enum": [
                  "idle",
                  "inProgress",
                  "completed",
                  "interrupted",
                  "error"
                ]
              },
              "cloudSessionIdentifier": {
                "type": [
                  "string",
                  "null"
                ],
                "minLength": 1
              },
              "title": {
                "type": [
                  "string",
                  "null"
                ],
                "minLength": 1
              },
              "createdAt": {
                "type": "string",
                "format": "date-time"
              },
              "updatedAt": {
                "type": "string",
                "format": "date-time"
              },
              "modeSwitchedAt": {
                "type": [
                  "string",
                  "null"
                ],
                "format": "date-time"
              }
            },
            "required": [
              "threadId",
              "tenantId",
              "tenantSlug",
              "executionMode",
              "executionHost",
              "status",
              "createdAt",
              "updatedAt"
            ]
          }
        },
        "required": [
          "thread"
        ]
      },
      "AgentThreadModePatchRequest": {
        "type": "object",
        "properties": {
          "executionMode": {
            "type": "string",
            "enum": [
              "cloud",
              "local"
            ]
          },
          "executionHost": {
            "type": "string",
            "enum": [
              "dynamic_sessions",
              "desktop_local"
            ]
          }
        },
        "required": [
          "executionMode"
        ]
      },
      "AgentThreadModePatchResponse": {
        "type": "object",
        "properties": {
          "thread": {
            "type": "object",
            "properties": {
              "threadId": {
                "type": "string",
                "minLength": 1
              },
              "tenantId": {
                "type": "string",
                "minLength": 1
              },
              "tenantSlug": {
                "type": "string",
                "minLength": 1
              },
              "executionMode": {
                "type": "string",
                "enum": [
                  "cloud",
                  "local"
                ]
              },
              "executionHost": {
                "type": "string",
                "enum": [
                  "dynamic_sessions",
                  "desktop_local"
                ]
              },
              "status": {
                "type": "string",
                "enum": [
                  "idle",
                  "inProgress",
                  "completed",
                  "interrupted",
                  "error"
                ]
              },
              "cloudSessionIdentifier": {
                "type": [
                  "string",
                  "null"
                ],
                "minLength": 1
              },
              "title": {
                "type": [
                  "string",
                  "null"
                ],
                "minLength": 1
              },
              "createdAt": {
                "type": "string",
                "format": "date-time"
              },
              "updatedAt": {
                "type": "string",
                "format": "date-time"
              },
              "modeSwitchedAt": {
                "type": [
                  "string",
                  "null"
                ],
                "format": "date-time"
              }
            },
            "required": [
              "threadId",
              "tenantId",
              "tenantSlug",
              "executionMode",
              "executionHost",
              "status",
              "createdAt",
              "updatedAt"
            ]
          }
        },
        "required": [
          "thread"
        ]
      },
      "AgentTurnStartRequest": {
        "type": "object",
        "properties": {
          "text": {
            "type": "string",
            "minLength": 1
          },
          "executionMode": {
            "type": "string",
            "enum": [
              "cloud",
              "local"
            ]
          },
          "executionHost": {
            "type": "string",
            "enum": [
              "dynamic_sessions",
              "desktop_local"
            ]
          },
          "model": {
            "type": "string",
            "minLength": 1
          },
          "approvalPolicy": {
            "type": "string",
            "minLength": 1
          },
          "sandboxPolicy": {},
          "effort": {
            "type": "string",
            "minLength": 1
          },
          "personality": {
            "type": "string",
            "minLength": 1
          }
        },
        "required": [
          "text"
        ]
      },
      "AgentTurnStartResponse": {
        "type": "object",
        "properties": {
          "turn": {
            "type": "object",
            "properties": {
              "turnId": {
                "type": "string",
                "minLength": 1
              },
              "threadId": {
                "type": "string",
                "minLength": 1
              },
              "status": {
                "type": "string",
                "enum": [
                  "idle",
                  "inProgress",
                  "completed",
                  "interrupted",
                  "error"
                ]
              },
              "executionMode": {
                "type": "string",
                "enum": [
                  "cloud",
                  "local"
                ]
              },
              "executionHost": {
                "type": "string",
                "enum": [
                  "dynamic_sessions",
                  "desktop_local"
                ]
              },
              "input": {},
              "output": {},
              "error": {},
              "startedAt": {
                "type": "string",
                "format": "date-time"
              },
              "completedAt": {
                "type": [
                  "string",
                  "null"
                ],
                "format": "date-time"
              }
            },
            "required": [
              "turnId",
              "threadId",
              "status",
              "executionMode",
              "executionHost",
              "startedAt"
            ]
          },
          "outputText": {
            "type": [
              "string",
              "null"
            ]
          }
        },
        "required": [
          "turn"
        ]
      },
      "AgentTurnInterruptResponse": {
        "type": "object",
        "properties": {
          "turn": {
            "type": "object",
            "properties": {
              "turnId": {
                "type": "string",
                "minLength": 1
              },
              "threadId": {
                "type": "string",
                "minLength": 1
              },
              "status": {
                "type": "string",
                "enum": [
                  "idle",
                  "inProgress",
                  "completed",
                  "interrupted",
                  "error"
                ]
              },
              "executionMode": {
                "type": "string",
                "enum": [
                  "cloud",
                  "local"
                ]
              },
              "executionHost": {
                "type": "string",
                "enum": [
                  "dynamic_sessions",
                  "desktop_local"
                ]
              },
              "input": {},
              "output": {},
              "error": {},
              "startedAt": {
                "type": "string",
                "format": "date-time"
              },
              "completedAt": {
                "type": [
                  "string",
                  "null"
                ],
                "format": "date-time"
              }
            },
            "required": [
              "turnId",
              "threadId",
              "status",
              "executionMode",
              "executionHost",
              "startedAt"
            ]
          }
        },
        "required": [
          "turn"
        ]
      },
      "AgentEventsBatchRequest": {
        "type": "object",
        "properties": {
          "events": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "turnId": {
                  "type": "string",
                  "minLength": 1
                },
                "method": {
                  "type": "string",
                  "minLength": 1
                },
                "payload": {}
              },
              "required": [
                "method"
              ]
            }
          }
        },
        "required": [
          "events"
        ]
      },
      "AgentEventsBatchResponse": {
        "type": "object",
        "properties": {
          "accepted": {
            "type": "integer",
            "minimum": 0
          }
        },
        "required": [
          "accepted"
        ]
      },
      "AgentEventsListResponse": {
        "type": "object",
        "properties": {
          "events": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "cursor": {
                  "type": "integer",
                  "minimum": 0
                },
                "threadId": {
                  "type": "string",
                  "minLength": 1
                },
                "turnId": {
                  "type": [
                    "string",
                    "null"
                  ],
                  "minLength": 1
                },
                "method": {
                  "type": "string",
                  "minLength": 1
                },
                "payload": {},
                "createdAt": {
                  "type": "string",
                  "format": "date-time"
                }
              },
              "required": [
                "cursor",
                "threadId",
                "method",
                "createdAt"
              ]
            }
          }
        },
        "required": [
          "events"
        ]
      }
    },
    "parameters": {}
  },
  "paths": {
    "/health": {
      "get": {
        "operationId": "getHealth",
        "summary": "Get API health status",
        "tags": [
          "System"
        ],
        "responses": {
          "200": {
            "description": "API health status",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "status": {
                      "type": "string",
                      "enum": [
                        "ok"
                      ]
                    },
                    "timestamp": {
                      "type": "string",
                      "format": "date-time"
                    }
                  },
                  "required": [
                    "status",
                    "timestamp"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/v1/ping": {
      "get": {
        "operationId": "getPing",
        "summary": "Get API ping response",
        "tags": [
          "System"
        ],
        "responses": {
          "200": {
            "description": "API ping response",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "ok": {
                      "type": "boolean",
                      "enum": [
                        true
                      ]
                    },
                    "service": {
                      "type": "string",
                      "enum": [
                        "api"
                      ]
                    }
                  },
                  "required": [
                    "ok",
                    "service"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/v1/auth/entra/start": {
      "get": {
        "operationId": "startEntraLogin",
        "summary": "Start Entra login flow",
        "tags": [
          "Auth"
        ],
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "required": false,
            "name": "returnTo",
            "in": "query"
          }
        ],
        "responses": {
          "302": {
            "description": "Redirect to Entra authorize endpoint"
          },
          "400": {
            "description": "Invalid request",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "string",
                      "minLength": 1
                    },
                    "message": {
                      "type": "string",
                      "minLength": 1
                    }
                  },
                  "required": [
                    "code",
                    "message"
                  ]
                }
              }
            }
          },
          "429": {
            "description": "Rate limited",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "string",
                      "minLength": 1
                    },
                    "message": {
                      "type": "string",
                      "minLength": 1
                    }
                  },
                  "required": [
                    "code",
                    "message"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/v1/auth/entra/callback": {
      "get": {
        "operationId": "handleEntraCallback",
        "summary": "Handle Entra callback and establish session",
        "tags": [
          "Auth"
        ],
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "required": false,
            "name": "code",
            "in": "query"
          },
          {
            "schema": {
              "type": "string"
            },
            "required": false,
            "name": "state",
            "in": "query"
          },
          {
            "schema": {
              "type": "string"
            },
            "required": false,
            "name": "admin_consent",
            "in": "query"
          },
          {
            "schema": {
              "type": "string"
            },
            "required": false,
            "name": "tenant",
            "in": "query"
          },
          {
            "schema": {
              "type": "string"
            },
            "required": false,
            "name": "scope",
            "in": "query"
          },
          {
            "schema": {
              "type": "string"
            },
            "required": false,
            "name": "error",
            "in": "query"
          },
          {
            "schema": {
              "type": "string"
            },
            "required": false,
            "name": "error_description",
            "in": "query"
          }
        ],
        "responses": {
          "302": {
            "description": "Redirect to workspace or return target"
          },
          "400": {
            "description": "Invalid callback state or token",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "string",
                      "minLength": 1
                    },
                    "message": {
                      "type": "string",
                      "minLength": 1
                    }
                  },
                  "required": [
                    "code",
                    "message"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "Authentication failed",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "string",
                      "minLength": 1
                    },
                    "message": {
                      "type": "string",
                      "minLength": 1
                    }
                  },
                  "required": [
                    "code",
                    "message"
                  ]
                }
              }
            }
          },
          "403": {
            "description": "Tenant not allowed",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "string",
                      "minLength": 1
                    },
                    "message": {
                      "type": "string",
                      "minLength": 1
                    }
                  },
                  "required": [
                    "code",
                    "message"
                  ]
                }
              }
            }
          },
          "429": {
            "description": "Rate limited",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "string",
                      "minLength": 1
                    },
                    "message": {
                      "type": "string",
                      "minLength": 1
                    }
                  },
                  "required": [
                    "code",
                    "message"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/v1/auth/entra/admin-consent/start": {
      "get": {
        "operationId": "startEntraAdminConsent",
        "summary": "Start Entra admin consent flow",
        "tags": [
          "Auth"
        ],
        "parameters": [
          {
            "schema": {
              "type": "string"
            },
            "required": false,
            "name": "tenantHint",
            "in": "query"
          },
          {
            "schema": {
              "type": "string"
            },
            "required": false,
            "name": "returnTo",
            "in": "query"
          }
        ],
        "responses": {
          "302": {
            "description": "Redirect to Entra admin consent endpoint"
          },
          "429": {
            "description": "Rate limited",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "string",
                      "minLength": 1
                    },
                    "message": {
                      "type": "string",
                      "minLength": 1
                    }
                  },
                  "required": [
                    "code",
                    "message"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/v1/auth/me": {
      "get": {
        "operationId": "getAuthMe",
        "summary": "Return current authenticated user and memberships",
        "tags": [
          "Auth"
        ],
        "security": [
          {
            "sessionCookieAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Authenticated context",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "authenticated": {
                      "type": "boolean"
                    },
                    "user": {
                      "type": [
                        "object",
                        "null"
                      ],
                      "properties": {
                        "id": {
                          "type": "string",
                          "minLength": 1
                        },
                        "primaryEmail": {
                          "type": [
                            "string",
                            "null"
                          ],
                          "format": "email"
                        },
                        "displayName": {
                          "type": [
                            "string",
                            "null"
                          ],
                          "minLength": 1
                        }
                      },
                      "required": [
                        "id"
                      ]
                    },
                    "memberships": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "tenantId": {
                            "type": "string",
                            "minLength": 1
                          },
                          "tenantSlug": {
                            "type": "string",
                            "minLength": 1
                          },
                          "tenantName": {
                            "type": "string",
                            "minLength": 1
                          },
                          "role": {
                            "type": "string",
                            "enum": [
                              "owner",
                              "admin",
                              "member",
                              "viewer"
                            ]
                          },
                          "status": {
                            "type": "string",
                            "enum": [
                              "active",
                              "invited",
                              "disabled"
                            ]
                          }
                        },
                        "required": [
                          "tenantId",
                          "tenantSlug",
                          "tenantName",
                          "role",
                          "status"
                        ]
                      }
                    },
                    "lastActiveTenantSlug": {
                      "type": [
                        "string",
                        "null"
                      ],
                      "minLength": 1
                    }
                  },
                  "required": [
                    "authenticated",
                    "memberships"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "No active session",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "string",
                      "minLength": 1
                    },
                    "message": {
                      "type": "string",
                      "minLength": 1
                    }
                  },
                  "required": [
                    "code",
                    "message"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/v1/auth/logout": {
      "post": {
        "operationId": "logout",
        "summary": "Revoke current session",
        "tags": [
          "Auth"
        ],
        "security": [
          {
            "sessionCookieAuth": []
          }
        ],
        "responses": {
          "204": {
            "description": "Session revoked"
          }
        }
      }
    },
    "/v1/tenants": {
      "post": {
        "operationId": "createTenant",
        "summary": "Create a tenant and owner membership",
        "tags": [
          "Tenants"
        ],
        "security": [
          {
            "sessionCookieAuth": []
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "slug": {
                    "type": "string",
                    "minLength": 2,
                    "maxLength": 64,
                    "pattern": "^[a-z0-9]+(?:-[a-z0-9]+)*$"
                  },
                  "name": {
                    "type": "string",
                    "minLength": 1,
                    "maxLength": 120
                  }
                },
                "required": [
                  "slug",
                  "name"
                ]
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Tenant created",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "tenant": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "string",
                          "minLength": 1
                        },
                        "slug": {
                          "type": "string",
                          "minLength": 1
                        },
                        "name": {
                          "type": "string",
                          "minLength": 1
                        },
                        "status": {
                          "type": "string",
                          "enum": [
                            "active",
                            "disabled"
                          ]
                        }
                      },
                      "required": [
                        "id",
                        "slug",
                        "name",
                        "status"
                      ]
                    },
                    "membership": {
                      "type": "object",
                      "properties": {
                        "role": {
                          "type": "string",
                          "enum": [
                            "owner",
                            "admin",
                            "member",
                            "viewer"
                          ]
                        },
                        "status": {
                          "type": "string",
                          "enum": [
                            "active",
                            "invited",
                            "disabled"
                          ]
                        }
                      },
                      "required": [
                        "role",
                        "status"
                      ]
                    }
                  },
                  "required": [
                    "tenant",
                    "membership"
                  ]
                }
              }
            }
          },
          "400": {
            "description": "Invalid request",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "string",
                      "minLength": 1
                    },
                    "message": {
                      "type": "string",
                      "minLength": 1
                    }
                  },
                  "required": [
                    "code",
                    "message"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "string",
                      "minLength": 1
                    },
                    "message": {
                      "type": "string",
                      "minLength": 1
                    }
                  },
                  "required": [
                    "code",
                    "message"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/v1/tenants/{tenantSlug}": {
      "get": {
        "operationId": "getTenant",
        "summary": "Read tenant metadata",
        "tags": [
          "Tenants"
        ],
        "security": [
          {
            "sessionCookieAuth": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string",
              "minLength": 1
            },
            "required": true,
            "name": "tenantSlug",
            "in": "path"
          }
        ],
        "responses": {
          "200": {
            "description": "Tenant details",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "tenant": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "string",
                          "minLength": 1
                        },
                        "slug": {
                          "type": "string",
                          "minLength": 1
                        },
                        "name": {
                          "type": "string",
                          "minLength": 1
                        },
                        "status": {
                          "type": "string",
                          "enum": [
                            "active",
                            "disabled"
                          ]
                        }
                      },
                      "required": [
                        "id",
                        "slug",
                        "name",
                        "status"
                      ]
                    }
                  },
                  "required": [
                    "tenant"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "string",
                      "minLength": 1
                    },
                    "message": {
                      "type": "string",
                      "minLength": 1
                    }
                  },
                  "required": [
                    "code",
                    "message"
                  ]
                }
              }
            }
          },
          "403": {
            "description": "Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "string",
                      "minLength": 1
                    },
                    "message": {
                      "type": "string",
                      "minLength": 1
                    }
                  },
                  "required": [
                    "code",
                    "message"
                  ]
                }
              }
            }
          },
          "404": {
            "description": "Tenant not found",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "string",
                      "minLength": 1
                    },
                    "message": {
                      "type": "string",
                      "minLength": 1
                    }
                  },
                  "required": [
                    "code",
                    "message"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/v1/tenants/{tenantSlug}/members": {
      "get": {
        "operationId": "listTenantMembers",
        "summary": "List tenant members",
        "tags": [
          "Tenants"
        ],
        "security": [
          {
            "sessionCookieAuth": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string",
              "minLength": 1
            },
            "required": true,
            "name": "tenantSlug",
            "in": "path"
          }
        ],
        "responses": {
          "200": {
            "description": "Tenant members",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "members": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "userId": {
                            "type": "string",
                            "minLength": 1
                          },
                          "primaryEmail": {
                            "type": [
                              "string",
                              "null"
                            ],
                            "format": "email"
                          },
                          "displayName": {
                            "type": [
                              "string",
                              "null"
                            ],
                            "minLength": 1
                          },
                          "role": {
                            "type": "string",
                            "enum": [
                              "owner",
                              "admin",
                              "member",
                              "viewer"
                            ]
                          },
                          "status": {
                            "type": "string",
                            "enum": [
                              "active",
                              "invited",
                              "disabled"
                            ]
                          }
                        },
                        "required": [
                          "userId",
                          "role",
                          "status"
                        ]
                      }
                    }
                  },
                  "required": [
                    "members"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "string",
                      "minLength": 1
                    },
                    "message": {
                      "type": "string",
                      "minLength": 1
                    }
                  },
                  "required": [
                    "code",
                    "message"
                  ]
                }
              }
            }
          },
          "403": {
            "description": "Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "string",
                      "minLength": 1
                    },
                    "message": {
                      "type": "string",
                      "minLength": 1
                    }
                  },
                  "required": [
                    "code",
                    "message"
                  ]
                }
              }
            }
          },
          "404": {
            "description": "Tenant not found",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "string",
                      "minLength": 1
                    },
                    "message": {
                      "type": "string",
                      "minLength": 1
                    }
                  },
                  "required": [
                    "code",
                    "message"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/v1/tenants/{tenantSlug}/invites": {
      "post": {
        "operationId": "createTenantInvite",
        "summary": "Create tenant invite",
        "tags": [
          "Tenants"
        ],
        "security": [
          {
            "sessionCookieAuth": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string",
              "minLength": 1
            },
            "required": true,
            "name": "tenantSlug",
            "in": "path"
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "email": {
                    "type": "string",
                    "format": "email"
                  },
                  "role": {
                    "type": "string",
                    "enum": [
                      "admin",
                      "member",
                      "viewer"
                    ]
                  },
                  "expiresInDays": {
                    "type": "integer",
                    "minimum": 1,
                    "maximum": 30
                  }
                },
                "required": [
                  "email",
                  "role"
                ]
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Invite created",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "inviteId": {
                      "type": "string",
                      "minLength": 1
                    },
                    "expiresAt": {
                      "type": "string",
                      "format": "date-time"
                    },
                    "token": {
                      "type": "string",
                      "minLength": 1
                    }
                  },
                  "required": [
                    "inviteId",
                    "expiresAt",
                    "token"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "string",
                      "minLength": 1
                    },
                    "message": {
                      "type": "string",
                      "minLength": 1
                    }
                  },
                  "required": [
                    "code",
                    "message"
                  ]
                }
              }
            }
          },
          "403": {
            "description": "Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "string",
                      "minLength": 1
                    },
                    "message": {
                      "type": "string",
                      "minLength": 1
                    }
                  },
                  "required": [
                    "code",
                    "message"
                  ]
                }
              }
            }
          },
          "404": {
            "description": "Tenant not found",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "string",
                      "minLength": 1
                    },
                    "message": {
                      "type": "string",
                      "minLength": 1
                    }
                  },
                  "required": [
                    "code",
                    "message"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/v1/tenants/{tenantSlug}/invites/{token}/accept": {
      "post": {
        "operationId": "acceptTenantInvite",
        "summary": "Accept tenant invite",
        "tags": [
          "Tenants"
        ],
        "security": [
          {
            "sessionCookieAuth": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string",
              "minLength": 1
            },
            "required": true,
            "name": "tenantSlug",
            "in": "path"
          },
          {
            "schema": {
              "type": "string",
              "minLength": 1
            },
            "required": true,
            "name": "token",
            "in": "path"
          }
        ],
        "responses": {
          "200": {
            "description": "Invite accepted",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "joined": {
                      "type": "boolean"
                    },
                    "tenantSlug": {
                      "type": "string",
                      "minLength": 1
                    },
                    "role": {
                      "type": "string",
                      "enum": [
                        "owner",
                        "admin",
                        "member",
                        "viewer"
                      ]
                    },
                    "status": {
                      "type": "string",
                      "enum": [
                        "active",
                        "invited",
                        "disabled"
                      ]
                    }
                  },
                  "required": [
                    "joined",
                    "tenantSlug",
                    "role",
                    "status"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "string",
                      "minLength": 1
                    },
                    "message": {
                      "type": "string",
                      "minLength": 1
                    }
                  },
                  "required": [
                    "code",
                    "message"
                  ]
                }
              }
            }
          },
          "403": {
            "description": "Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "string",
                      "minLength": 1
                    },
                    "message": {
                      "type": "string",
                      "minLength": 1
                    }
                  },
                  "required": [
                    "code",
                    "message"
                  ]
                }
              }
            }
          },
          "404": {
            "description": "Invite not found",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "string",
                      "minLength": 1
                    },
                    "message": {
                      "type": "string",
                      "minLength": 1
                    }
                  },
                  "required": [
                    "code",
                    "message"
                  ]
                }
              }
            }
          },
          "409": {
            "description": "Invite already accepted by another user",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "string",
                      "minLength": 1
                    },
                    "message": {
                      "type": "string",
                      "minLength": 1
                    }
                  },
                  "required": [
                    "code",
                    "message"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/v1/agent/threads": {
      "post": {
        "operationId": "createAgentThread",
        "summary": "Create an agent thread",
        "tags": [
          "Agent"
        ],
        "security": [
          {
            "sessionCookieAuth": []
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "tenantSlug": {
                    "type": "string",
                    "minLength": 1
                  },
                  "executionMode": {
                    "type": "string",
                    "enum": [
                      "cloud",
                      "local"
                    ],
                    "default": "cloud"
                  },
                  "executionHost": {
                    "type": "string",
                    "enum": [
                      "dynamic_sessions",
                      "desktop_local"
                    ]
                  },
                  "title": {
                    "type": "string",
                    "minLength": 1,
                    "maxLength": 200
                  }
                },
                "required": [
                  "tenantSlug"
                ]
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Agent thread created",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "thread": {
                      "type": "object",
                      "properties": {
                        "threadId": {
                          "type": "string",
                          "minLength": 1
                        },
                        "tenantId": {
                          "type": "string",
                          "minLength": 1
                        },
                        "tenantSlug": {
                          "type": "string",
                          "minLength": 1
                        },
                        "executionMode": {
                          "type": "string",
                          "enum": [
                            "cloud",
                            "local"
                          ]
                        },
                        "executionHost": {
                          "type": "string",
                          "enum": [
                            "dynamic_sessions",
                            "desktop_local"
                          ]
                        },
                        "status": {
                          "type": "string",
                          "enum": [
                            "idle",
                            "inProgress",
                            "completed",
                            "interrupted",
                            "error"
                          ]
                        },
                        "cloudSessionIdentifier": {
                          "type": [
                            "string",
                            "null"
                          ],
                          "minLength": 1
                        },
                        "title": {
                          "type": [
                            "string",
                            "null"
                          ],
                          "minLength": 1
                        },
                        "createdAt": {
                          "type": "string",
                          "format": "date-time"
                        },
                        "updatedAt": {
                          "type": "string",
                          "format": "date-time"
                        },
                        "modeSwitchedAt": {
                          "type": [
                            "string",
                            "null"
                          ],
                          "format": "date-time"
                        }
                      },
                      "required": [
                        "threadId",
                        "tenantId",
                        "tenantSlug",
                        "executionMode",
                        "executionHost",
                        "status",
                        "createdAt",
                        "updatedAt"
                      ]
                    }
                  },
                  "required": [
                    "thread"
                  ]
                }
              }
            }
          },
          "400": {
            "description": "Invalid request",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "string",
                      "minLength": 1
                    },
                    "message": {
                      "type": "string",
                      "minLength": 1
                    }
                  },
                  "required": [
                    "code",
                    "message"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "string",
                      "minLength": 1
                    },
                    "message": {
                      "type": "string",
                      "minLength": 1
                    }
                  },
                  "required": [
                    "code",
                    "message"
                  ]
                }
              }
            }
          },
          "403": {
            "description": "Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "string",
                      "minLength": 1
                    },
                    "message": {
                      "type": "string",
                      "minLength": 1
                    }
                  },
                  "required": [
                    "code",
                    "message"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/v1/agent/threads/{threadId}": {
      "get": {
        "operationId": "getAgentThread",
        "summary": "Read an agent thread",
        "tags": [
          "Agent"
        ],
        "security": [
          {
            "sessionCookieAuth": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string",
              "minLength": 1
            },
            "required": true,
            "name": "threadId",
            "in": "path"
          }
        ],
        "responses": {
          "200": {
            "description": "Agent thread state",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "thread": {
                      "type": "object",
                      "properties": {
                        "threadId": {
                          "type": "string",
                          "minLength": 1
                        },
                        "tenantId": {
                          "type": "string",
                          "minLength": 1
                        },
                        "tenantSlug": {
                          "type": "string",
                          "minLength": 1
                        },
                        "executionMode": {
                          "type": "string",
                          "enum": [
                            "cloud",
                            "local"
                          ]
                        },
                        "executionHost": {
                          "type": "string",
                          "enum": [
                            "dynamic_sessions",
                            "desktop_local"
                          ]
                        },
                        "status": {
                          "type": "string",
                          "enum": [
                            "idle",
                            "inProgress",
                            "completed",
                            "interrupted",
                            "error"
                          ]
                        },
                        "cloudSessionIdentifier": {
                          "type": [
                            "string",
                            "null"
                          ],
                          "minLength": 1
                        },
                        "title": {
                          "type": [
                            "string",
                            "null"
                          ],
                          "minLength": 1
                        },
                        "createdAt": {
                          "type": "string",
                          "format": "date-time"
                        },
                        "updatedAt": {
                          "type": "string",
                          "format": "date-time"
                        },
                        "modeSwitchedAt": {
                          "type": [
                            "string",
                            "null"
                          ],
                          "format": "date-time"
                        }
                      },
                      "required": [
                        "threadId",
                        "tenantId",
                        "tenantSlug",
                        "executionMode",
                        "executionHost",
                        "status",
                        "createdAt",
                        "updatedAt"
                      ]
                    }
                  },
                  "required": [
                    "thread"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "string",
                      "minLength": 1
                    },
                    "message": {
                      "type": "string",
                      "minLength": 1
                    }
                  },
                  "required": [
                    "code",
                    "message"
                  ]
                }
              }
            }
          },
          "403": {
            "description": "Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "string",
                      "minLength": 1
                    },
                    "message": {
                      "type": "string",
                      "minLength": 1
                    }
                  },
                  "required": [
                    "code",
                    "message"
                  ]
                }
              }
            }
          },
          "404": {
            "description": "Thread not found",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "string",
                      "minLength": 1
                    },
                    "message": {
                      "type": "string",
                      "minLength": 1
                    }
                  },
                  "required": [
                    "code",
                    "message"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/v1/agent/threads/{threadId}/mode": {
      "patch": {
        "operationId": "patchAgentThreadMode",
        "summary": "Switch execution mode for an agent thread",
        "tags": [
          "Agent"
        ],
        "security": [
          {
            "sessionCookieAuth": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string",
              "minLength": 1
            },
            "required": true,
            "name": "threadId",
            "in": "path"
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "executionMode": {
                    "type": "string",
                    "enum": [
                      "cloud",
                      "local"
                    ]
                  },
                  "executionHost": {
                    "type": "string",
                    "enum": [
                      "dynamic_sessions",
                      "desktop_local"
                    ]
                  }
                },
                "required": [
                  "executionMode"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Thread mode updated",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "thread": {
                      "type": "object",
                      "properties": {
                        "threadId": {
                          "type": "string",
                          "minLength": 1
                        },
                        "tenantId": {
                          "type": "string",
                          "minLength": 1
                        },
                        "tenantSlug": {
                          "type": "string",
                          "minLength": 1
                        },
                        "executionMode": {
                          "type": "string",
                          "enum": [
                            "cloud",
                            "local"
                          ]
                        },
                        "executionHost": {
                          "type": "string",
                          "enum": [
                            "dynamic_sessions",
                            "desktop_local"
                          ]
                        },
                        "status": {
                          "type": "string",
                          "enum": [
                            "idle",
                            "inProgress",
                            "completed",
                            "interrupted",
                            "error"
                          ]
                        },
                        "cloudSessionIdentifier": {
                          "type": [
                            "string",
                            "null"
                          ],
                          "minLength": 1
                        },
                        "title": {
                          "type": [
                            "string",
                            "null"
                          ],
                          "minLength": 1
                        },
                        "createdAt": {
                          "type": "string",
                          "format": "date-time"
                        },
                        "updatedAt": {
                          "type": "string",
                          "format": "date-time"
                        },
                        "modeSwitchedAt": {
                          "type": [
                            "string",
                            "null"
                          ],
                          "format": "date-time"
                        }
                      },
                      "required": [
                        "threadId",
                        "tenantId",
                        "tenantSlug",
                        "executionMode",
                        "executionHost",
                        "status",
                        "createdAt",
                        "updatedAt"
                      ]
                    }
                  },
                  "required": [
                    "thread"
                  ]
                }
              }
            }
          },
          "400": {
            "description": "Invalid request",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "string",
                      "minLength": 1
                    },
                    "message": {
                      "type": "string",
                      "minLength": 1
                    }
                  },
                  "required": [
                    "code",
                    "message"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "string",
                      "minLength": 1
                    },
                    "message": {
                      "type": "string",
                      "minLength": 1
                    }
                  },
                  "required": [
                    "code",
                    "message"
                  ]
                }
              }
            }
          },
          "403": {
            "description": "Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "string",
                      "minLength": 1
                    },
                    "message": {
                      "type": "string",
                      "minLength": 1
                    }
                  },
                  "required": [
                    "code",
                    "message"
                  ]
                }
              }
            }
          },
          "409": {
            "description": "Thread mode switch conflict",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "string",
                      "minLength": 1
                    },
                    "message": {
                      "type": "string",
                      "minLength": 1
                    }
                  },
                  "required": [
                    "code",
                    "message"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/v1/agent/threads/{threadId}/turns": {
      "post": {
        "operationId": "createAgentTurn",
        "summary": "Start a turn for an agent thread",
        "tags": [
          "Agent"
        ],
        "security": [
          {
            "sessionCookieAuth": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string",
              "minLength": 1
            },
            "required": true,
            "name": "threadId",
            "in": "path"
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "text": {
                    "type": "string",
                    "minLength": 1
                  },
                  "executionMode": {
                    "type": "string",
                    "enum": [
                      "cloud",
                      "local"
                    ]
                  },
                  "executionHost": {
                    "type": "string",
                    "enum": [
                      "dynamic_sessions",
                      "desktop_local"
                    ]
                  },
                  "model": {
                    "type": "string",
                    "minLength": 1
                  },
                  "approvalPolicy": {
                    "type": "string",
                    "minLength": 1
                  },
                  "sandboxPolicy": {},
                  "effort": {
                    "type": "string",
                    "minLength": 1
                  },
                  "personality": {
                    "type": "string",
                    "minLength": 1
                  }
                },
                "required": [
                  "text"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Turn accepted and processed",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "turn": {
                      "type": "object",
                      "properties": {
                        "turnId": {
                          "type": "string",
                          "minLength": 1
                        },
                        "threadId": {
                          "type": "string",
                          "minLength": 1
                        },
                        "status": {
                          "type": "string",
                          "enum": [
                            "idle",
                            "inProgress",
                            "completed",
                            "interrupted",
                            "error"
                          ]
                        },
                        "executionMode": {
                          "type": "string",
                          "enum": [
                            "cloud",
                            "local"
                          ]
                        },
                        "executionHost": {
                          "type": "string",
                          "enum": [
                            "dynamic_sessions",
                            "desktop_local"
                          ]
                        },
                        "input": {},
                        "output": {},
                        "error": {},
                        "startedAt": {
                          "type": "string",
                          "format": "date-time"
                        },
                        "completedAt": {
                          "type": [
                            "string",
                            "null"
                          ],
                          "format": "date-time"
                        }
                      },
                      "required": [
                        "turnId",
                        "threadId",
                        "status",
                        "executionMode",
                        "executionHost",
                        "startedAt"
                      ]
                    },
                    "outputText": {
                      "type": [
                        "string",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "turn"
                  ]
                }
              }
            }
          },
          "400": {
            "description": "Invalid request",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "string",
                      "minLength": 1
                    },
                    "message": {
                      "type": "string",
                      "minLength": 1
                    }
                  },
                  "required": [
                    "code",
                    "message"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "string",
                      "minLength": 1
                    },
                    "message": {
                      "type": "string",
                      "minLength": 1
                    }
                  },
                  "required": [
                    "code",
                    "message"
                  ]
                }
              }
            }
          },
          "403": {
            "description": "Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "string",
                      "minLength": 1
                    },
                    "message": {
                      "type": "string",
                      "minLength": 1
                    }
                  },
                  "required": [
                    "code",
                    "message"
                  ]
                }
              }
            }
          },
          "404": {
            "description": "Thread not found",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "string",
                      "minLength": 1
                    },
                    "message": {
                      "type": "string",
                      "minLength": 1
                    }
                  },
                  "required": [
                    "code",
                    "message"
                  ]
                }
              }
            }
          },
          "409": {
            "description": "Turn conflict",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "string",
                      "minLength": 1
                    },
                    "message": {
                      "type": "string",
                      "minLength": 1
                    }
                  },
                  "required": [
                    "code",
                    "message"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/v1/agent/threads/{threadId}/turns/{turnId}/interrupt": {
      "post": {
        "operationId": "interruptAgentTurn",
        "summary": "Interrupt an in-progress turn",
        "tags": [
          "Agent"
        ],
        "security": [
          {
            "sessionCookieAuth": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string",
              "minLength": 1
            },
            "required": true,
            "name": "threadId",
            "in": "path"
          },
          {
            "schema": {
              "type": "string",
              "minLength": 1
            },
            "required": true,
            "name": "turnId",
            "in": "path"
          }
        ],
        "responses": {
          "200": {
            "description": "Turn interrupted",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "turn": {
                      "type": "object",
                      "properties": {
                        "turnId": {
                          "type": "string",
                          "minLength": 1
                        },
                        "threadId": {
                          "type": "string",
                          "minLength": 1
                        },
                        "status": {
                          "type": "string",
                          "enum": [
                            "idle",
                            "inProgress",
                            "completed",
                            "interrupted",
                            "error"
                          ]
                        },
                        "executionMode": {
                          "type": "string",
                          "enum": [
                            "cloud",
                            "local"
                          ]
                        },
                        "executionHost": {
                          "type": "string",
                          "enum": [
                            "dynamic_sessions",
                            "desktop_local"
                          ]
                        },
                        "input": {},
                        "output": {},
                        "error": {},
                        "startedAt": {
                          "type": "string",
                          "format": "date-time"
                        },
                        "completedAt": {
                          "type": [
                            "string",
                            "null"
                          ],
                          "format": "date-time"
                        }
                      },
                      "required": [
                        "turnId",
                        "threadId",
                        "status",
                        "executionMode",
                        "executionHost",
                        "startedAt"
                      ]
                    }
                  },
                  "required": [
                    "turn"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "string",
                      "minLength": 1
                    },
                    "message": {
                      "type": "string",
                      "minLength": 1
                    }
                  },
                  "required": [
                    "code",
                    "message"
                  ]
                }
              }
            }
          },
          "403": {
            "description": "Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "string",
                      "minLength": 1
                    },
                    "message": {
                      "type": "string",
                      "minLength": 1
                    }
                  },
                  "required": [
                    "code",
                    "message"
                  ]
                }
              }
            }
          },
          "404": {
            "description": "Thread/turn not found",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "string",
                      "minLength": 1
                    },
                    "message": {
                      "type": "string",
                      "minLength": 1
                    }
                  },
                  "required": [
                    "code",
                    "message"
                  ]
                }
              }
            }
          },
          "409": {
            "description": "Turn state conflict",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "string",
                      "minLength": 1
                    },
                    "message": {
                      "type": "string",
                      "minLength": 1
                    }
                  },
                  "required": [
                    "code",
                    "message"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/v1/agent/threads/{threadId}/events:batch": {
      "post": {
        "operationId": "appendAgentThreadEventsBatch",
        "summary": "Append externally sourced events to a thread",
        "tags": [
          "Agent"
        ],
        "security": [
          {
            "sessionCookieAuth": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string",
              "minLength": 1
            },
            "required": true,
            "name": "threadId",
            "in": "path"
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "events": {
                    "type": "array",
                    "items": {
                      "type": "object",
                      "properties": {
                        "turnId": {
                          "type": "string",
                          "minLength": 1
                        },
                        "method": {
                          "type": "string",
                          "minLength": 1
                        },
                        "payload": {}
                      },
                      "required": [
                        "method"
                      ]
                    }
                  }
                },
                "required": [
                  "events"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Events accepted",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "accepted": {
                      "type": "integer",
                      "minimum": 0
                    }
                  },
                  "required": [
                    "accepted"
                  ]
                }
              }
            }
          },
          "400": {
            "description": "Invalid request",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "string",
                      "minLength": 1
                    },
                    "message": {
                      "type": "string",
                      "minLength": 1
                    }
                  },
                  "required": [
                    "code",
                    "message"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "string",
                      "minLength": 1
                    },
                    "message": {
                      "type": "string",
                      "minLength": 1
                    }
                  },
                  "required": [
                    "code",
                    "message"
                  ]
                }
              }
            }
          },
          "403": {
            "description": "Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "string",
                      "minLength": 1
                    },
                    "message": {
                      "type": "string",
                      "minLength": 1
                    }
                  },
                  "required": [
                    "code",
                    "message"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/v1/agent/threads/{threadId}/events": {
      "get": {
        "operationId": "listAgentThreadEvents",
        "summary": "List persisted thread events",
        "tags": [
          "Agent"
        ],
        "security": [
          {
            "sessionCookieAuth": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string",
              "minLength": 1
            },
            "required": true,
            "name": "threadId",
            "in": "path"
          },
          {
            "schema": {
              "type": [
                "integer",
                "null"
              ],
              "minimum": 0
            },
            "required": false,
            "name": "cursor",
            "in": "query"
          },
          {
            "schema": {
              "type": "integer",
              "minimum": 1,
              "maximum": 500
            },
            "required": false,
            "name": "limit",
            "in": "query"
          }
        ],
        "responses": {
          "200": {
            "description": "Thread events",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "events": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "cursor": {
                            "type": "integer",
                            "minimum": 0
                          },
                          "threadId": {
                            "type": "string",
                            "minLength": 1
                          },
                          "turnId": {
                            "type": [
                              "string",
                              "null"
                            ],
                            "minLength": 1
                          },
                          "method": {
                            "type": "string",
                            "minLength": 1
                          },
                          "payload": {},
                          "createdAt": {
                            "type": "string",
                            "format": "date-time"
                          }
                        },
                        "required": [
                          "cursor",
                          "threadId",
                          "method",
                          "createdAt"
                        ]
                      }
                    }
                  },
                  "required": [
                    "events"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "string",
                      "minLength": 1
                    },
                    "message": {
                      "type": "string",
                      "minLength": 1
                    }
                  },
                  "required": [
                    "code",
                    "message"
                  ]
                }
              }
            }
          },
          "403": {
            "description": "Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "string",
                      "minLength": 1
                    },
                    "message": {
                      "type": "string",
                      "minLength": 1
                    }
                  },
                  "required": [
                    "code",
                    "message"
                  ]
                }
              }
            }
          },
          "404": {
            "description": "Thread not found",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "string",
                      "minLength": 1
                    },
                    "message": {
                      "type": "string",
                      "minLength": 1
                    }
                  },
                  "required": [
                    "code",
                    "message"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/v1/agent/threads/{threadId}/stream": {
      "get": {
        "operationId": "streamAgentThreadEvents",
        "summary": "Upgrade to websocket stream for thread events",
        "tags": [
          "Agent"
        ],
        "security": [
          {
            "sessionCookieAuth": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "string",
              "minLength": 1
            },
            "required": true,
            "name": "threadId",
            "in": "path"
          },
          {
            "schema": {
              "type": [
                "integer",
                "null"
              ],
              "minimum": 0
            },
            "required": false,
            "name": "cursor",
            "in": "query"
          }
        ],
        "responses": {
          "101": {
            "description": "WebSocket protocol upgrade accepted"
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "string",
                      "minLength": 1
                    },
                    "message": {
                      "type": "string",
                      "minLength": 1
                    }
                  },
                  "required": [
                    "code",
                    "message"
                  ]
                }
              }
            }
          },
          "403": {
            "description": "Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "string",
                      "minLength": 1
                    },
                    "message": {
                      "type": "string",
                      "minLength": 1
                    }
                  },
                  "required": [
                    "code",
                    "message"
                  ]
                }
              }
            }
          },
          "404": {
            "description": "Thread not found",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "string",
                      "minLength": 1
                    },
                    "message": {
                      "type": "string",
                      "minLength": 1
                    }
                  },
                  "required": [
                    "code",
                    "message"
                  ]
                }
              }
            }
          }
        }
      }
    }
  },
  "webhooks": {}
}
